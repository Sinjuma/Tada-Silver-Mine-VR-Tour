<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Tada Silver Mine VR Tour</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <script>
        // --- 設定データ：各地点の画像情報をここに集約 ---
        const sceneData = {
            p1: { 
                main: "#img1", alt: "#img1_alt", next: "p2", prev: null ,
            nextPos: "6 2 -1",
            nextRot: "90 0 0",   
            prevPos: "0 0 0",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p2: { main: "#img2", alt: "#img2_alt", next: "p3", prev: "p1" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p3: { main: "#img3", alt: "#img3_alt", next: "p4", prev: "p2" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p4: { main: "#img4", alt: "#img4_alt", next: "p5", prev: "p3" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p5: { main: "#img5", alt: "#img5_alt", next: "p6", prev: "p4" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p6: { main: "#img6", alt: "#img6_alt", next: "p7", prev: "p5" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p7: { main: "#img7", alt: "#img7_alt", next: "p8", prev: "p6" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p8: { main: "#img8", alt: "#img8_alt", next: "p9", prev: "p7" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p9: { main: "#img9", alt: "#img9_alt", next: "p10", prev: "p8" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p10: { main: "#img10", alt: "#img10_alt", next: "p11", prev: "p9" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p11: { main: "#img11", alt: "#img11_alt", next: "p12", prev: "p10" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p12: { main: "#img12", alt: "#img12_alt", next: "p13", prev: "p11" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p13: { main: "#img13", alt: "#img13_alt", next: "p14", prev: "p12" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p14: { main: "#img14", alt: "#img14_alt", next: "p15", prev: "p13",
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
             },
            p15: { main: "#img15", alt: "#img15_alt", next: "p16", prev: "p14" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p16: { main: "#img16", alt: "#img16_alt", next: "p17", prev: "p15" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p17: { main: "#img17", alt: "#img17_alt", next: "p18", prev: "p16" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            p18: { main: "#img18", alt: "#img18_alt", next: "p1", prev: "p17" ,
            nextPos: "5 1.5 -5",
            nextRot: "0 -45 0",   
            prevPos: "-5 1.5 -5",
            prevRot: "0 0 0",
            togglePos: "0 1.5 -5",
            toggleRot: "0 0 0"
            },
            // ... p18まで同様に記述
        };

        // --- シーン切り替え関数 ---
       function goToScene(sceneId) {
            const data = sceneData[sceneId];
            if (!data) return;

            // 1. 背景画像を更新
            document.querySelector('#main-bg').setAttribute('src', data.main);

            // 2. 切り替えボタンの画像リストと位置・回転を更新
            const toggleBtn = document.querySelector('#toggle-btn');
            // コンポーネントへのデータ渡しを文字列形式に修正（エラー防止）
            toggleBtn.setAttribute('photo-toggle', `target: #main-bg; images: ${data.main}, ${data.alt}`);
            toggleBtn.setAttribute('position', data.togglePos);
            if (data.toggleRot) toggleBtn.setAttribute('rotation', data.toggleRot);

            // 3. 次へ・前へボタンの位置・回転を更新
            updateButton('#btn-next', data.next, data.nextPos, data.nextRot);
            updateButton('#btn-prev', data.prev, data.prevPos, data.prevRot);
        }

        // ボタンの表示・位置・イベントを一括更新する関数
        function updateButton(selector, targetId, pos, rot) {
            const btn = document.querySelector(selector);
            if (targetId && pos) {
                btn.setAttribute('visible', 'true');
                btn.setAttribute('position', pos);
                if (rot) btn.setAttribute('rotation', rot);
                btn.onclick = () => goToScene(targetId);
            } else {
                btn.setAttribute('visible', 'false');
            }
        }

        // --- 画像切り替えコンポーネント（修正版） ---
        AFRAME.registerComponent('photo-toggle', {
            schema: {
                target: {type: 'selector'},
                images: {type: 'array'}
            },
            init: function () {
                this.index = 0;
                this.el.addEventListener('click', () => {
                    // クリック時に最新の data.images を参照するように修正
                    const images = this.data.images;
                    if (!images || images.length < 2) return;
                    this.index = (this.index + 1) % images.length;
                    this.data.target.setAttribute('src', images[this.index]);
                });
            },
            update: function () {
                this.index = 0; // シーン移動時にリセット
            }
        });

        // ページ読み込み時に最初のシーンを実行
        window.onload = () => {
            goToScene('p1');
        };
    </script>
</head>
<body>
    <a-scene>
        <a-assets>
            <img id="img1" src="01.jpg"crossorigin="anonymous">
            <img id="img1_alt" src="1.jpg"crossorigin="anonymous">
            <img id="img2" src="02.jpg"crossorigin="anonymous">
            <img id="img2_alt" src="2.jpg"crossorigin="anonymous">
            <img id="img3" src="03.jpg"crossorigin="anonymous">
            <img id="img3_alt" src="3.jpg"crossorigin="anonymous">
            <img id="img4" src="04.jpg"crossorigin="anonymous">
            <img id="img4_alt" src="4.jpg"crossorigin="anonymous">
            <img id="img5" src="05.jpg"crossorigin="anonymous">
            <img id="img5_alt" src="5.jpg"crossorigin="anonymous">
            <img id="img6" src="06.jpg"crossorigin="anonymous">
            <img id="img6_alt" src="6.jpg"crossorigin="anonymous">
            <img id="img7" src="07.jpg"crossorigin="anonymous">
            <img id="img7_alt" src="7.jpg"crossorigin="anonymous">
            <img id="img8" src="08.jpg"crossorigin="anonymous">
            <img id="img8_alt" src="8.jpg"crossorigin="anonymous">
            <img id="img9" src="09.jpg"crossorigin="anonymous">
            <img id="img9_alt" src="9.jpg"crossorigin="anonymous">
            <img id="img10" src="010.jpg"crossorigin="anonymous">
            <img id="img10_alt" src="10.jpg"crossorigin="anonymous">
            <img id="img11" src="011.jpg"crossorigin="anonymous">
            <img id="img11_alt" src="11.jpg"crossorigin="anonymous">
            <img id="img12" src="012.jpg"crossorigin="anonymous">
            <img id="img12_alt" src="12.jpg"crossorigin="anonymous">
            <img id="img13" src="013.jpg"crossorigin="anonymous">
            <img id="img13_alt" src="13.jpg"crossorigin="anonymous">
            <img id="img14" src="014.jpg"crossorigin="anonymous">
            <img id="img14_alt" src="14.jpg"crossorigin="anonymous">
            <img id="img15" src="015.jpg"crossorigin="anonymous">
            <img id="img15_alt" src="15.jpg"crossorigin="anonymous">
            <img id="img16" src="016.jpg"crossorigin="anonymous">
            <img id="img16_alt" src="16.jpg"crossorigin="anonymous">
            <img id="img17" src="017.jpg"crossorigin="anonymous">
            <img id="img17_alt" src="17.jpg"crossorigin="anonymous">
            <img id="img18" src="018.jpg"crossorigin="anonymous">
            <img id="img18_alt" src="18.jpg"crossorigin="anonymous">
            <img id="icon-toggle" src="toggle_icon.png"crossorigin="anonymous">
            <img id="thumb-next" src="next_arrow.png"crossorigin="anonymous">
            <img id="thumb-prev" src="prev_arrow.png"crossorigin="anonymous">
        </a-assets>

        <a-sky id="main-bg" src="#img1"></a-sky>

        <a-entity id="toggle-group">
            <a-ring color="#FFFFFF" radius-inner="0.45" radius-outer="0.55" 
                    material="shader: flat; opacity: 0.6; transparent: true" position="0 0 -0.02"></a-ring>
            <a-image id="toggle-btn" src="#icon-toggle" width="0.8" height="0.8"></a-image>
        </a-entity>

        <a-entity id="next-group">
            <a-ring color="#00FFFF" radius-inner="0.45" radius-outer="0.55" 
                    material="shader: flat; opacity: 0.8; transparent: true" position="0 0 -0.02"></a-ring>
            <a-image id="btn-next" src="#thumb-next" width="0.8" height="0.8"></a-image>
        </a-entity>

        <a-entity id="prev-group" visible="false">
            <a-ring color="#CCCCCC" radius-inner="0.45" radius-outer="0.55" 
                    material="shader: flat; opacity: 0.8; transparent: true" position="0 0 -0.02"></a-ring>
            <a-image id="btn-prev" src="#thumb-prev" width="0.8" height="0.8"></a-image>
        </a-entity>

        <a-camera>
            <a-cursor fuse="true" color="#FF0000"></a-cursor>
        </a-camera>
    </a-scene>
</body>
</html>